!function(t){function e(s){if(n[s])return n[s].exports;var o=n[s]={exports:{},id:s,loaded:!1};return t[s].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function s(t){return t&&t.__esModule?t:{"default":t}}var o=n(4),r=s(o),a=n(5),i=(0,a.start)(),u=new r["default"](i);u.connect("monitor").then(function(){console.log("Socket now steaming data")})},function(t,e,n){(function(t){"use strict";function s(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.db=void 0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}}(),a=n(2),i=s(a),u=n(8),l=s(u),c=n(11),f=s(c),d=n(3),m=s(d),h=process.env.NODE_ENV,v=function(){function e(){var n=this;o(this,e),"test"===h?this.file=m["default"].join(t,"data/store-test.db"):this.file=m["default"].join(t,"data/store.db");var s=l["default"].existsSync(this.file);f["default"].verbose(),this.db=new f["default"].Database(this.file),this.db.serialize(function(){if(n.db.run("CREATE TABLE IF NOT EXISTS messages (status TEXT, load REAL, timestamp INTEGER)"),n.db.run("CREATE TABLE IF NOT EXISTS snapshots (freeMem INTEGER, uptime INTEGER, loadAvg1, loadAvg5, loadAvg15, timestamp INTEGER)"),!s&&"test"!==h){for(var t=n.db.prepare("INSERT INTO snapshots VALUES(?, ?, ?, ?, ?, ?)"),e=(new Date).getTime(),o=0;60>o;o++){var r=i["default"].loadavg();t.run(i["default"].freemem(),i["default"].uptime(),r[0],r[1],r[2],e+1e4)}t.finalize()}})}return r(e,[{key:"save",value:function(t,e){var n=this;return new Promise(function(s,o){var r=Object.keys(e),a=r.map(function(t){return e[t]}),i="INSERT INTO "+t+" ("+r.join(", ")+") VALUES ("+a.map(function(t){return"?"}).join(", ")+")";n.db.run(i,a,function(t){t?o(t):s()})})}},{key:"get",value:function(t){var e=this;return new Promise(function(n,s){e.db.all("SELECT * FROM "+t+" ORDER BY timestamp DESC",function(t,e){t?s(t):n(e)})})}},{key:"clearMessages",value:function(){var t=this;return new Promise(function(e,n){t.db.run("DELETE FROM messages",function(t){t?n(t):e()})})}}]),e}();e["default"]=v;e.db=new v}).call(e,"server/src")},function(t,e){t.exports=require("os")},function(t,e){t.exports=require("path")},function(t,e,n){"use strict";function s(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){var n=[],s=!0,o=!1,r=void 0;try{for(var a,i=t[Symbol.iterator]();!(s=(a=i.next()).done)&&(n.push(a.value),!e||n.length!==e);s=!0);}catch(u){o=!0,r=u}finally{try{!s&&i["return"]&&i["return"]()}finally{if(o)throw r}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function t(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}}(),i=n(9),u=s(i),l=n(2),c=s(l),f=n(10),d=s(f),m=n(1),h=function(){function t(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];o(this,t),this.isMonitoring=!1,this.threshold=c["default"].cpus().length,this.status="normal",this.messageDuration=12e4,n.messageDuration&&(this.messageDuration=n.messageDuration),e&&(this.io=(0,d["default"])(e))}return a(t,[{key:"checkStatus",value:function(){var t=c["default"].loadavg()[0];t>this.threshold&&"normal"===this.status?(this.status="danger",this.sendStatus({load:t})):t<this.threshold&&"danger"===this.status&&(this.status="normal",this.sendStatus({load:t})),console.log("Status: "+this.status+", Load: "+t)}},{key:"connect",value:function(t){var e=this;return new Promise(function(n,s){e.io.of(t).on("connection",function(t){e.socket=t,e.isMonitoring||(e.startMonitoring(),n(t)),m.db.get("messages").then(function(t){t&&e.socket.emit("message",t)}),m.db.get("snapshots").then(function(t){t&&t.length&&!function(){var n=c["default"].totalmem();t.forEach(function(t){t.totalMem=n}),e.socket.emit("monitor",t)}()})})})}},{key:"monitor",value:function(t){var e=(new Date).getTime(),n=c["default"].loadavg(),s=r(n,3),o=s[0],a=s[1],i=s[2],u=c["default"].freemem(),l=c["default"].uptime(),f={freeMem:u,uptime:l,loadAvg1:o,loadAvg5:a,loadAvg15:i,timestamp:e};m.db.save("snapshots",f)["catch"](function(t){console.log(t)}),f.totalMem=c["default"].totalmem(),this.socket.emit("monitor",f)}},{key:"sendStatus",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];t.status=this.status,t.timestamp=(new Date).getTime(),m.db.save("messages",t),console.log(t),this.socket.emit("message",t)}},{key:"startMonitoring",value:function(){this.isMonitoring=!0,u["default"].on("monitor",this.monitor.bind(this)),this.statusTimer=setInterval(this.checkStatus.bind(this),this.messageDuration),u["default"].start({delay:1e4,critical1:c["default"].cpus().length,immediate:!0})}}]),t}();e["default"]=h},function(t,e,n){(function(t){"use strict";function s(t){return t&&t.__esModule?t:{"default":t}}function o(){return d.listen(3e3,function(){console.log("WatchDog on guard.")})}Object.defineProperty(e,"__esModule",{value:!0}),e.start=o;var r=n(6),a=s(r),i=n(1),u=n(7),l=s(u),c=n(3),f=s(c),d=(0,a["default"])(),m=void 0;switch(process.env.NODE_ENV){case"production":m=f["default"].resolve(t,"../../public");break;case"test":m=f["default"].resolve(t,"../../tmp");break;default:m=f["default"].resolve(t,"../../dist")}d.use(a["default"]["static"](m)),d.use((0,l["default"])({allowedOrigins:["localhost:3001"]})),d.get("/",function(t,e){e.sendFile(f["default"].join(m,"index.html"))}),d["delete"]("/messages",function(t,e){i.db.clearMessages().then(function(){e.sendStatus(200)},function(t){e.status(500).send(t)})}),e["default"]=d}).call(e,"server/src")},function(t,e){t.exports=require("express")},function(t,e){t.exports=require("express-cors")},function(t,e){t.exports=require("fs")},function(t,e){t.exports=require("os-monitor")},function(t,e){t.exports=require("socket.io")},function(t,e){t.exports=require("sqlite3")}]);